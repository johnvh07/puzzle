<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no">
  <title>Puzzle</title>
  <style type="text/css">
    body{
      background-color: #222;
    }
    div#saves {
      display: inline-block;
      margin-left: 3.8%;
    }
    div#saves a {
      color: #222;
      font-family: sans-serif;
      font-size: 12pt;
      text-decoration: none;
      padding: 5px 8px;
      background: #6fd6ff;
      border-radius: 2px;
      display: inline-block;
      margin-right: -4px;
    }
    div#saves button {
      padding: 5px 8px;
      font-size: 12pt;
      border-radius: 2px;
      background: #ff777d;
      border: none;
      cursor: pointer;
    }
    div#grid {
      display: flex;
      flex-wrap: wrap;
      font-size: 30px;
      text-align: center;
    }
    .grid-cell {
      padding: 10px;
    /*6 column*/
      flex: 14%;
    }
    /*5 column*/
    @media (max-width: 2100px) {
      .grid-cell {
        flex: 19%;
      }
    }
    /*4 column*/
    @media (max-width: 1600px) {
      .grid-cell {
        flex: 25%;
      }
    }
    /*3 column*/
    @media (max-width: 1200px) {
      .grid-cell {
        flex: 30%;
      }
    }
    /*2 column*/
    @media (max-width: 900px) {
      .grid-cell {
        flex: 45%;
      }
    }
    /*1 column*/
    @media (max-width: 500px) {
      .grid-cell {
        flex: 100%;
      }
    }   
    div#grid h3 {
      color: #f1f1f1;
      font-family: sans-serif;
      font-size: 18pt;
    }
    div#grid .grid-cell img {
      width: 80%;
      border-radius: 5px;  /* I'd prefer 2% of img width, but don't know how to do that. */
    }
    div#grid .grid-cell video {
      width: 80%;
      margin: auto;
      border-radius: 5px;  /* I'd prefer 2% of img width, but don't know how to do that. */
    }
    
    


    /*--------------puzzle size buttons-------------------*/
    div#grid .grid-cell div a {
      color: #222222;
      font-family: sans-serif;
      font-size: 12pt;
      text-decoration: none;
      border-radius: 2px;
      padding: 5px 8px;
      margin: 5px;
      display: inline-block;
    }
    div#grid .grid-cell div a:hover {
      opacity: 0.4;
    }
    div#grid .grid-cell div a:nth-child(1) {
      background:#b7ff6f
    }
    div#grid .grid-cell div a:nth-child(2) {
      background:#ffb95d
    }
    div#grid .grid-cell div a:nth-child(3) {
      background:#ff777d
    }
  </style>
</head>
<body>
    <div id='saves'></div>
    <div id='grid'></div>
  <script src="https://cdn.jsdelivr.net/npm/lodash@4.17.15/lodash.js"></script>
  <script
  src="https://code.jquery.com/jquery-3.5.1.min.js"
  integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
  crossorigin="anonymous"></script>
  <script>
    fetch(`https://petervh.com/live/info.json`)
    .then(response => response.json())
    .then( function(data){
      data.forEach( function(item ,index){
          let thumbnail_url = item['320px_jpg'] || ('https://petervh.com/live/'+item.name+'/1.jpg');
          let vid_thumbnail_url = item['320px_bounce_mp4'];
          let tile = '<div class="grid-cell"><h3>' + item.name + '</h3><video alt="preview of puzzle named' + item.name + '" loop preload="none" poster="' + thumbnail_url + '"><source src="' + vid_thumbnail_url + '" type="video/mp4">Your browser does not support the video tag.<img alt="preview of puzzle named' + item.name + '" src="' + thumbnail_url + '"></video><div><a href="puzzle.html?image=' + item.name + '&pieces=25">25 piece</a><a href="puzzle.html?image=' + item.name + '&pieces=100">100 piece</a><a href="puzzle.html?image=' + item.name + '&pieces=400">400 piece</a></div></div>';
          $('div#grid').append(tile);
      });
      $(".grid-cell video").hover(function(){
        $(this).parent().addClass("active");
        $(this).attr("controls","true");
        $(this).get()[0].play();
      }, function(){
        $(this).parent().removeClass("active");
        $(this).removeAttr("controls");
        $(this).get()[0].pause();
      });
    });
    function DeleteSavedPuzzle() {
      localStorage.removeItem('saveProgress');
      $('div#save1').remove();
    }
    // Retrieve Save Info
    if (localStorage.getItem("saveProgress")==null){
      console.log('no saved progress');
    } else {
      console.log(localStorage.getItem("saveProgress"));
      function timeSince(date) {
        var seconds = Math.floor((new Date()/ 1000) - date );
        var interval = seconds / 31536000;
        if (interval > 1) {
          return Math.floor(interval) + " years";
        }
        interval = seconds / 2592000;
        if (interval > 1) {
          return Math.floor(interval) + " months";
        }
        interval = seconds / 86400;
        if (interval > 1) {
          return Math.floor(interval) + " days";
        }
        interval = seconds / 3600;
        if (interval > 1) {
          return Math.floor(interval) + " hours";
        }
        interval = seconds / 60;
        if (interval > 1) {
          return Math.floor(interval) + " minutes";
        }
        return Math.floor(seconds) + " seconds";
        }
      var puzzleSaveInfo = JSON.parse(localStorage.getItem("saveProgress")),
          timeAgoSaved = timeSince(puzzleSaveInfo['timeSaved']),
          linkText = '' + puzzleSaveInfo['image'] + ' ' + puzzleSaveInfo['size'] + ' piece puzzle last saved ' + timeAgoSaved + ' ago',
          linkDestination = 'puzzle.html',
          saveHTML = '<div id="save1"><a href="' + linkDestination + '">' + linkText + '</a><button onclick="DeleteSavedPuzzle()">delete save</button></div>';
      $('div#saves').append(saveHTML);
    }
  </script>
</body>
</html>
